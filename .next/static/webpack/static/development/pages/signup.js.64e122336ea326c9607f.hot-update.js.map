{"version":3,"file":"static/webpack/static/development/pages/signup.js.64e122336ea326c9607f.hot-update.js","sources":["webpack:///./pages/signup.js"],"sourcesContent":["import { Component } from \"react\";\nimport styled from \"styled-components\";\nimport axios from \"axios\";\nimport debounce from \"lodash/debounce\";\nimport Head from \"next/head\";\n\nimport config from \"../config\";\nimport { Router } from \"../routes\";\nimport { Link } from \"../components/Link\";\nimport Layout from \"../components/Layout\";\nimport Input from \"../components/Input\";\nimport Button from \"../components/Button\";\nimport { SubTitle, Title, Body } from \"../components/Text\";\n\nfunction validateEmail(email) {\n  var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n  return re.test(String(email).toLowerCase());\n}\n\nexport function isValidUsername(str) {\n  let code = null;\n  for (let i = 0, length = str.length; i < length; i++) {\n    code = str.charCodeAt(i);\n    if (\n      !(code > 47 && code < 58) && // numeric 0-9\n      !(code > 64 && code < 91) && // upper alpha A-Z\n      !(code > 96 && code < 123) && // lower alpha a-z\n      !(code === 95)\n    ) {\n      // underscore _\n      return false;\n    }\n  }\n  return true;\n}\n\nconst SignupContainer = styled.div`\n  margin: auto;\n  width: ${({ isTouch }) => (isTouch ? \"100%\" : \"500px\")};\n  padding: ${({ isTouch }) => (isTouch ? \"20px 20px 80px 20px\" : \"80px 0\")};\n`;\n\nexport default class Signup extends Component {\n  state = {\n    email: \"\",\n    password: \"\",\n    passwordVerification: \"\",\n    username: \"\",\n    submitted: false,\n    submitting: false,\n    valid: false,\n    tips: {}\n  };\n  componentDidMount() {\n    this.validChecker = debounce(this.checkValidity, 1000);\n  }\n  signup = async () => {\n    console.log(\"try submit\");\n    const { valid, email, password, username } = this.state;\n    if (!valid) {\n      return false;\n    }\n    this.setState({ submitting: true });\n    const response = await axios({\n      url: config.api.host + \"/user\",\n      method: \"POST\",\n      data: { email, password, username: username.toLowerCase() }\n    });\n    console.log(response.data);\n    if (response.data.error) {\n      if (response.data.error === \"email_exists\") {\n        this.setState({\n          submitting: false,\n          valid: false,\n          tips: { email: \"This email is already taken =(\" }\n        });\n      }\n      if (response.data.error === \"username_exists\") {\n        this.setState({\n          submitting: false,\n          valid: false,\n          tips: { username: \"This username is already taken =(\" }\n        });\n      }\n    } else {\n      this.setState({ submitted: true });\n    }\n  };\n  checkValidity = () => {\n    const { email, username, password } = this.state;\n    console.log(Math.random());\n    console.log(validateEmail(email));\n    const tips = {};\n    if (email.length > 0 && !validateEmail(email)) {\n      tips.email = \"Not quite an email\";\n    }\n    if (username.length > 0 && !isValidUsername(username)) {\n      tips.username = \"We only support letters, numbers and _\";\n    }\n    if (password.length > 0 && password.length < 8) {\n      tips.password = \"Use 8 characters at least\";\n    }\n    const valid =\n      Object.keys(tips).length === 0 &&\n      email.length > 0 &&\n      password.length > 0 &&\n      username.length > 0;\n    console.log(tips, valid);\n    this.setState({ tips, valid });\n  };\n  onChangeEmail = ev => {\n    this.setState({ email: ev.target.value });\n    this.validChecker();\n  };\n  onChangeUsername = ev => {\n    this.setState({ username: ev.target.value });\n    this.validChecker();\n  };\n  onChangePassword = ev => {\n    this.setState({ password: ev.target.value });\n    this.validChecker();\n  };\n\n  onKeyDown = event => {\n    if (event && event.key === \"Enter\") {\n      event.preventDefault();\n      event.stopPropagation();\n      this.checkValidity();\n      setTimeout(this.signup, 100);\n    }\n  };\n\n  render() {\n    const { auth, user, isTouch } = this.props;\n    const {\n      email,\n      username,\n      password,\n      submitted,\n      tips,\n      valid,\n      submitting\n    } = this.state;\n    if (auth) {\n      Router.pushRoute(\"dashboard\");\n    }\n    return (\n      <Layout auth={auth} user={user} isTouch={isTouch}>\n        <Head>\n          <title>Signup - Jaresume</title>\n        </Head>\n        <SignupContainer isTouch={isTouch} onKeyDown={this.onKeyDown}>\n          {submitted && (\n            <div>Great work! Check your inbox to confirm your account.</div>\n          )}\n          {!submitted && (\n            <div>\n              {\" \"}\n              <br />\n              <br />\n              <Title>Signup</Title>\n              <br />\n              <br />\n              <Input\n                label=\"Email\"\n                subLabel={tips.email}\n                type=\"text\"\n                onChange={this.onChangeEmail}\n                value={email}\n              />\n              <Input\n                label=\"Username\"\n                subLabel={tips.username}\n                onChange={this.onChangeUsername}\n                value={username}\n              />\n              <Input\n                label=\"Password\"\n                type=\"password\"\n                subLabel={tips.password}\n                onChange={this.onChangePassword}\n                value={password}\n              />\n              <Button disabled={submitting} onClick={this.signup}>\n                Signup\n              </Button>\n              <br />\n              <Body>\n                {/* Already have an account? <Link href=\"/login\">login</Link> */}\n              </Body>\n            </div>\n          )}\n        </SignupContainer>\n      </Layout>\n    );\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AACA;AAYA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAMA;AAAA;AAAA;AACA;AAPA;AAAA;AAQA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAHA;AACA;AARA;AAOA;AAKA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAHA;AAKA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAHA;AAKA;AACA;AACA;AAAA;AAAA;AACA;AACA;AA/BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AA+BA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAKA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;;;;;;AA9EA;AACA;AACA;;;AA6EA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAUA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;;;;AAzJA;AACA;;;;;A","sourceRoot":""}
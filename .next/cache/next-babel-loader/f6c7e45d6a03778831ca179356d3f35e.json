{"ast":null,"code":"import _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime-corejs2/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/roland/repos/learn2spell-app/pages/signup.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: auto;\\n  width: \", \";\\n  padding: \", \";\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport { Component } from \"react\";\nimport styled from \"styled-components\";\nimport axios from \"axios\";\nimport debounce from \"lodash/debounce\";\nimport Head from \"next/head\";\nimport config from \"../config\";\nimport { Router } from \"../routes\";\nimport { Link } from \"../components/Link\";\nimport Layout from \"../components/Layout\";\nimport Input from \"../components/Input\";\nimport Button from \"../components/Button\";\nimport { SubTitle, Title, Body } from \"../components/Text\";\n\nfunction validateEmail(email) {\n  var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n  return re.test(String(email).toLowerCase());\n}\n\nexport function isValidUsername(str) {\n  var code = null;\n\n  for (var i = 0, length = str.length; i < length; i++) {\n    code = str.charCodeAt(i);\n\n    if (!(code > 47 && code < 58) && // numeric 0-9\n    !(code > 64 && code < 91) && // upper alpha A-Z\n    !(code > 96 && code < 123) && // lower alpha a-z\n    !(code === 95)) {\n      // underscore _\n      return false;\n    }\n  }\n\n  return true;\n}\nvar SignupContainer = styled.div(_templateObject(), function (_ref) {\n  var isTouch = _ref.isTouch;\n  return isTouch ? \"100%\" : \"500px\";\n}, function (_ref2) {\n  var isTouch = _ref2.isTouch;\n  return isTouch ? \"20px 20px 80px 20px\" : \"80px 0\";\n});\n\nvar Signup =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Signup, _Component);\n\n  function Signup() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Signup);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Signup)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      email: \"\",\n      password: \"\",\n      passwordVerification: \"\",\n      username: \"\",\n      submitted: false,\n      submitting: false,\n      valid: false,\n      tips: {}\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"signup\", function _callee() {\n      var _this$state, valid, email, password, username, response;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              console.log(\"try submit\");\n              _this$state = _this.state, valid = _this$state.valid, email = _this$state.email, password = _this$state.password, username = _this$state.username;\n\n              if (valid) {\n                _context.next = 4;\n                break;\n              }\n\n              return _context.abrupt(\"return\", false);\n\n            case 4:\n              _this.setState({\n                submitting: true\n              });\n\n              _context.next = 7;\n              return _regeneratorRuntime.awrap(axios({\n                url: config.api.host + \"/user\",\n                method: \"POST\",\n                data: {\n                  email: email,\n                  password: password,\n                  username: username.toLowerCase()\n                }\n              }));\n\n            case 7:\n              response = _context.sent;\n              console.log(response.data);\n\n              if (response.data.error) {\n                if (response.data.error === \"email_exists\") {\n                  _this.setState({\n                    submitting: false,\n                    valid: false,\n                    tips: {\n                      email: \"This email is already taken =(\"\n                    }\n                  });\n                }\n\n                if (response.data.error === \"username_exists\") {\n                  _this.setState({\n                    submitting: false,\n                    valid: false,\n                    tips: {\n                      username: \"This username is already taken =(\"\n                    }\n                  });\n                }\n              } else {\n                _this.setState({\n                  submitted: true\n                });\n              }\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"checkValidity\", function () {\n      var _this$state2 = _this.state,\n          email = _this$state2.email,\n          username = _this$state2.username,\n          password = _this$state2.password;\n      console.log(Math.random());\n      console.log(validateEmail(email));\n      var tips = {};\n\n      if (email.length > 0 && !validateEmail(email)) {\n        tips.email = \"Not quite an email\";\n      }\n\n      if (username.length > 0 && !isValidUsername(username)) {\n        tips.username = \"We only support letters, numbers and _\";\n      }\n\n      if (password.length > 0 && password.length < 8) {\n        tips.password = \"Use 8 characters at least\";\n      }\n\n      var valid = _Object$keys(tips).length === 0 && email.length > 0 && password.length > 0 && username.length > 0;\n      console.log(tips, valid);\n\n      _this.setState({\n        tips: tips,\n        valid: valid\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChangeEmail\", function (ev) {\n      _this.setState({\n        email: ev.target.value\n      });\n\n      _this.validChecker();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChangeUsername\", function (ev) {\n      _this.setState({\n        username: ev.target.value\n      });\n\n      _this.validChecker();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChangePassword\", function (ev) {\n      _this.setState({\n        password: ev.target.value\n      });\n\n      _this.validChecker();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onKeyDown\", function (event) {\n      if (event && event.key === \"Enter\") {\n        event.preventDefault();\n        event.stopPropagation();\n\n        _this.checkValidity();\n\n        setTimeout(_this.signup, 100);\n      }\n    });\n\n    return _this;\n  }\n\n  _createClass(Signup, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.validChecker = debounce(this.checkValidity, 1000);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          auth = _this$props.auth,\n          user = _this$props.user,\n          isTouch = _this$props.isTouch;\n      var _this$state3 = this.state,\n          email = _this$state3.email,\n          username = _this$state3.username,\n          password = _this$state3.password,\n          submitted = _this$state3.submitted,\n          tips = _this$state3.tips,\n          valid = _this$state3.valid,\n          submitting = _this$state3.submitting;\n\n      if (auth) {\n        Router.pushRoute(\"dashboard\");\n      }\n\n      return __jsx(Layout, {\n        auth: auth,\n        user: user,\n        isTouch: isTouch,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, __jsx(Head, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149\n        },\n        __self: this\n      }, __jsx(\"title\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }, \"Signup - Jaresume\")), __jsx(SignupContainer, {\n        isTouch: isTouch,\n        onKeyDown: this.onKeyDown,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      }, submitted && __jsx(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }, \"Great work! Check your inbox to confirm your account.\"), !submitted && __jsx(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, \" \", __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }), __jsx(Title, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, \"Signup\"), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }), __jsx(Input, {\n        label: \"Email\",\n        subLabel: tips.email,\n        type: \"text\",\n        onChange: this.onChangeEmail,\n        value: email,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }), __jsx(Input, {\n        label: \"Username\",\n        subLabel: tips.username,\n        onChange: this.onChangeUsername,\n        value: username,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      }), __jsx(Input, {\n        label: \"Password\",\n        type: \"password\",\n        subLabel: tips.password,\n        onChange: this.onChangePassword,\n        value: password,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 177\n        },\n        __self: this\n      }), __jsx(Button, {\n        disabled: submitting,\n        onClick: this.signup,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }, \"Signup\"), __jsx(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }), __jsx(Body, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, \"Already have an account? \", __jsx(Link, {\n        href: \"/login\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, \"login\")))));\n    }\n  }]);\n\n  return Signup;\n}(Component);\n\nexport { Signup as default };","map":{"version":3,"sources":["/home/roland/repos/learn2spell-app/pages/signup.js"],"names":["Component","styled","axios","debounce","Head","config","Router","Link","Layout","Input","Button","SubTitle","Title","Body","validateEmail","email","re","test","String","toLowerCase","isValidUsername","str","code","i","length","charCodeAt","SignupContainer","div","isTouch","Signup","password","passwordVerification","username","submitted","submitting","valid","tips","console","log","state","setState","url","api","host","method","data","response","error","Math","random","ev","target","value","validChecker","event","key","preventDefault","stopPropagation","checkValidity","setTimeout","signup","props","auth","user","pushRoute","onKeyDown","onChangeEmail","onChangeUsername","onChangePassword"],"mappings":"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","sourcesContent":["import { Component } from \"react\";\nimport styled from \"styled-components\";\nimport axios from \"axios\";\nimport debounce from \"lodash/debounce\";\nimport Head from \"next/head\";\n\nimport config from \"../config\";\nimport { Router } from \"../routes\";\nimport { Link } from \"../components/Link\";\nimport Layout from \"../components/Layout\";\nimport Input from \"../components/Input\";\nimport Button from \"../components/Button\";\nimport { SubTitle, Title, Body } from \"../components/Text\";\n\nfunction validateEmail(email) {\n  var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n  return re.test(String(email).toLowerCase());\n}\n\nexport function isValidUsername(str) {\n  let code = null;\n  for (let i = 0, length = str.length; i < length; i++) {\n    code = str.charCodeAt(i);\n    if (\n      !(code > 47 && code < 58) && // numeric 0-9\n      !(code > 64 && code < 91) && // upper alpha A-Z\n      !(code > 96 && code < 123) && // lower alpha a-z\n      !(code === 95)\n    ) {\n      // underscore _\n      return false;\n    }\n  }\n  return true;\n}\n\nconst SignupContainer = styled.div`\n  margin: auto;\n  width: ${({ isTouch }) => (isTouch ? \"100%\" : \"500px\")};\n  padding: ${({ isTouch }) => (isTouch ? \"20px 20px 80px 20px\" : \"80px 0\")};\n`;\n\nexport default class Signup extends Component {\n  state = {\n    email: \"\",\n    password: \"\",\n    passwordVerification: \"\",\n    username: \"\",\n    submitted: false,\n    submitting: false,\n    valid: false,\n    tips: {}\n  };\n  componentDidMount() {\n    this.validChecker = debounce(this.checkValidity, 1000);\n  }\n  signup = async () => {\n    console.log(\"try submit\");\n    const { valid, email, password, username } = this.state;\n    if (!valid) {\n      return false;\n    }\n    this.setState({ submitting: true });\n    const response = await axios({\n      url: config.api.host + \"/user\",\n      method: \"POST\",\n      data: { email, password, username: username.toLowerCase() }\n    });\n    console.log(response.data);\n    if (response.data.error) {\n      if (response.data.error === \"email_exists\") {\n        this.setState({\n          submitting: false,\n          valid: false,\n          tips: { email: \"This email is already taken =(\" }\n        });\n      }\n      if (response.data.error === \"username_exists\") {\n        this.setState({\n          submitting: false,\n          valid: false,\n          tips: { username: \"This username is already taken =(\" }\n        });\n      }\n    } else {\n      this.setState({ submitted: true });\n    }\n  };\n  checkValidity = () => {\n    const { email, username, password } = this.state;\n    console.log(Math.random());\n    console.log(validateEmail(email));\n    const tips = {};\n    if (email.length > 0 && !validateEmail(email)) {\n      tips.email = \"Not quite an email\";\n    }\n    if (username.length > 0 && !isValidUsername(username)) {\n      tips.username = \"We only support letters, numbers and _\";\n    }\n    if (password.length > 0 && password.length < 8) {\n      tips.password = \"Use 8 characters at least\";\n    }\n    const valid =\n      Object.keys(tips).length === 0 &&\n      email.length > 0 &&\n      password.length > 0 &&\n      username.length > 0;\n    console.log(tips, valid);\n    this.setState({ tips, valid });\n  };\n  onChangeEmail = ev => {\n    this.setState({ email: ev.target.value });\n    this.validChecker();\n  };\n  onChangeUsername = ev => {\n    this.setState({ username: ev.target.value });\n    this.validChecker();\n  };\n  onChangePassword = ev => {\n    this.setState({ password: ev.target.value });\n    this.validChecker();\n  };\n\n  onKeyDown = event => {\n    if (event && event.key === \"Enter\") {\n      event.preventDefault();\n      event.stopPropagation();\n      this.checkValidity();\n      setTimeout(this.signup, 100);\n    }\n  };\n\n  render() {\n    const { auth, user, isTouch } = this.props;\n    const {\n      email,\n      username,\n      password,\n      submitted,\n      tips,\n      valid,\n      submitting\n    } = this.state;\n    if (auth) {\n      Router.pushRoute(\"dashboard\");\n    }\n    return (\n      <Layout auth={auth} user={user} isTouch={isTouch}>\n        <Head>\n          <title>Signup - Jaresume</title>\n        </Head>\n        <SignupContainer isTouch={isTouch} onKeyDown={this.onKeyDown}>\n          {submitted && (\n            <div>Great work! Check your inbox to confirm your account.</div>\n          )}\n          {!submitted && (\n            <div>\n              {\" \"}\n              <br />\n              <br />\n              <Title>Signup</Title>\n              <br />\n              <br />\n              <Input\n                label=\"Email\"\n                subLabel={tips.email}\n                type=\"text\"\n                onChange={this.onChangeEmail}\n                value={email}\n              />\n              <Input\n                label=\"Username\"\n                subLabel={tips.username}\n                onChange={this.onChangeUsername}\n                value={username}\n              />\n              <Input\n                label=\"Password\"\n                type=\"password\"\n                subLabel={tips.password}\n                onChange={this.onChangePassword}\n                value={password}\n              />\n              <Button disabled={submitting} onClick={this.signup}>\n                Signup\n              </Button>\n              <br />\n              <Body>\n                Already have an account? <Link href=\"/login\">login</Link>\n              </Body>\n            </div>\n          )}\n        </SignupContainer>\n      </Layout>\n    );\n  }\n}"]},"metadata":{},"sourceType":"module"}